var LO={codes:[],langs:{},trans:{},qz:{},scores:{},curr:localStorage.curr||"it",phrases:["Hello","Goodbye","A cold beer, please"],api:function(d,b,c){d=d||"Translate";b=b||{};b.appId="BC9A37B4174332CDC3E7591ABFE67BFCF2D616C9";var a="http://api.microsofttranslator.com/V2/Ajax.svc/"+d;return $.ajax({url:a,dataType:"jsonp",jsonp:"oncomplete",data:b,success:function(e){b.appId="";c(e,b,d)},error:function(f){alert("Error:"+f.statusText)}})},saveTrans:function(c,b,a){LO.trans[c][b]=a;localStorage.trans=(JSON.stringify(LO.trans))},getTrans:function(a,b){b=b||LO.showPhrase;a.from="en";a.to=LO.curr;if(typeof LO.trans[LO.curr]==="undefined"){LO.trans[LO.curr]={}}if(typeof LO.trans[LO.curr][a.text]==="undefined"){LO.api("Translate",a,function(c){LO.saveTrans(a.to,a.text,c);a.trans=c;b(a)})}else{a.trans=LO.trans[a.to][a.text];b(a)}},};LO.init=function(){var a=document.createElement("audio");LO.hasAudio=(a.canPlayType("audio/wav")!=="")?true:false;if(localStorage.phrases){LO.phrases=JSON.parse(localStorage.phrases)}if(localStorage.trans){LO.trans=JSON.parse(localStorage.trans)}if(localStorage.scores){LO.scores=JSON.parse(localStorage.scores)}LO.api("GetLanguagesForTranslate",null,function(e){LO.codes=e;var g,f,d,b,c=JSON.stringify(e);LO.api("GetLanguageNames",{locale:"en",languageCodes:c},function(h){g=h;LO.api("GetLanguagesForSpeak",null,function(j){f=j;for(d=0;d<g.length;d+=1){var i=e[d];var m=g[d];var k=0;for(b=0;b<f.length;b+=1){if(f[b]===i){k=1}}LO.langs[i]={c:i,n:m,s:k}}$("#curr em").html(LO.langs[LO.curr].n)})})})};LO.home=function(){$("#a").html("<h1>Welcome</h1>");$("#a").append('<p> Want some help learning a new language?  <br />Lingo lets you gather useful words and phrases. Once you\'ve learnt them take the quiz to see how good your knowledge really is.  </p> <p><a class="bn" href="javascript:LO.main();">Get Started &raquo;</a></p>')};LO.list=function(){var c;$("#a").html("<h1>Choose a language</h1>");for(c=0;c<LO.codes.length;c+=1){var b=LO.langs[LO.codes[c]];var f=LO.totalScore(b.c);var d=(f)?"<br /><small>"+f.total+"% in "+f.quiz+" test(s)</small>":"";var a=(b.s&&LO.hasAudio)?"ln sp":"ln";var e='<a class="r '+a+'" href="javascript: LO.changeCurr(\''+b.c+"')\">"+b.n+d+"</a>";$("#a").append(e)}};LO.main=function(){var a;$("#a").html("");var b='<form id="addPhrase" onsubmit="LO.addPhrase();return false;"><input type="text" required="true" placeholder="Add phrase" name="phrase" /><input type="submit" value="+"></form>';$("#a").append(b);for(a=this.phrases.length-1;a>=0;--a){LO.getTrans({text:LO.phrases[a],ignore:a},LO.showphrase)}};LO.buildPhrase=function(e,b){var a="<a href=\"javascript:LO.delPhrase('"+e+'\')" class="del">x</a>';var c=(LO.langs[LO.curr].s===1&&LO.hasAudio)?'<a class="lis sp" href="javascript:LO.say(\''+escape(b)+"')\">":"";var d=c+'<div class="phr r" id="phrase_'+e+'"><small>'+LO.phrases[e]+"</small><br /><strong>"+b+"</strong>"+a+"</div>";if(c.length){d+="</a>"}return d};LO.showPhrase=function(b){var a=LO.buildPhrase(b.ignore,b.trans);$("#a").append(a).slideDown()};LO.say=function(a){var b={format:"audio/wav",language:LO.curr,text:a};LO.api("Speak",b,function(d){var c=new Audio(d);c.play()})};LO.quiz=function(){LO.quizQ();$("#a").html("<h1>Test your knowledge</h1>");$("#a").html("<p>Q "+LO.qs.c+" of "+LO.qs.q+"</p>");var e=LO.qs.l[LO.qs.c];var b=LO.trans[LO.curr][e];var c='<p class="r hi">Translate:<br /><strong>'+e+"</strong></p>";var d='<form id=q onsubmit="LO.quizA();return false;"><input type=hidden name=q value="'+b+'"><input type=text placeholder=Answer required=true autocomplete=off name=a /><input type="submit" value="&raquo;" /></form>';$("#a").append(c);$("#a").append(d)};LO.quizQ=function(){if(sessionStorage.qs){LO.qs=JSON.parse(sessionStorage.qs);return}var a=LO.phrases;a.sort(function(d,c){return(0.5-Math.random())});if(a.length>9){a.splice(9,a.length)}LO.qs={c:1,q:a.length-1,l:a,s:0};sessionStorage.qs=JSON.stringify(LO.qs)};LO.quizA=function(){var e=$("form input[name=q]").val();var b=$("form input[name=a]").val();var f="";if(e.toLowerCase()===b.toLowerCase()){LO.qs.s+=1;f='<p class="ok r">Correct!</p>'}else{f='<p class="er r"><s>'+b+"</s><br />The answer was "+e+"</p>"}if(LO.qs.c>=LO.qs.q){var d=~~((LO.qs.s/LO.qs.q)*100);f+="Quiz finished. you got "+LO.qs.s+" out of "+LO.qs.q+" ("+d+")%";LO.quizS(LO.curr,d);LO.qs=null;sessionStorage.removeItem("qs")}else{f+='<a href="javascript:LO.quiz();" class="bn">Next Question &raquo;</a>';LO.qs.c+=1;sessionStorage.qs=JSON.stringify(LO.qs)}$("form").hide();$("p.hi").hide().removeClass("hi r").html(f).slideDown()};LO.quizS=function(c,a){if(typeof LO.scores[c]==="undefined"){LO.scores[c]={total:a,quiz:1}}else{var b=LO.scores[c];b.quiz+=1;b.total=~~((b.total+a)/2);LO.scores[c]=b}localStorage.scores=JSON.stringify(LO.scores)};LO.quizR=function(){LO.qs=undefined;sessionStorage.removeItem("qs")};LO.addPhrase=function(){var a=$("#addPhrase input:first").val();LO.phrases.push(a);var b=LO.phrases.length-1;localStorage.phrases=JSON.stringify(LO.phrases);LO.quizR();$("body").append('<div id="loading">Loading</div>');LO.getTrans({text:LO.phrases[b],ignore:b},function(e){var c=LO.buildPhrase(e.ignore,e.trans);$(c).insertBefore("#a div:first").hide().slideDown();$("#addPhrase input:first").val("").blur();$("#loading").fadeOut("fast").remove()})};LO.delPhrase=function(a){LO.phrases.splice(a,1);localStorage.phrases=JSON.stringify(LO.phrases);LO.quizR();$("#phrase_"+a).addClass("pk").slideToggle("fast")};LO.changeCurr=function(b){var a=LO.langs[b];$("#curr em").html(a.n).attr("id",a.c);LO.curr=a.c;localStorage.curr=a.c;window.location.hash="#phrases"};LO.totalScore=function(a){if(typeof LO.scores[a]==="undefined"){return}else{return LO.scores[a]}};LO.screens={home:function(){LO.home()},quiz:function(){LO.quiz()},list:function(){LO.list()},phrases:function(){LO.main()}};LO.router=setInterval(function(){var a=window.location.hash.replace("#","")||"home";if(a!==LO.page){LO.page=a;try{LO.screens[a].call()}catch(b){LO.screens.home.call()}}},120);LO.init();